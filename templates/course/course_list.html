{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'course_css/course_list.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <h2 class="mb-4">📘 Courses</h2>

  <div class="button-group">
    <a href="{% url 'add_course' %}" class="btn-success">➕ Add Course</a>
    <a href="{% url 'create_course' %}" class="btn-primary">📝 Create Course</a>
  </div>

  {% csrf_token %}

  <table class="course-table">
    <thead>
      <tr>
        <th>#</th>
        <th>Course Name</th>
        <th>Sub Column</th>
        <th>Unicode</th>
        <th>Start Date</th>
        <th>End Date</th>
        <th>Fees</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for course in courses %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ course.name }}</td>
        <td>{{ course.sub_column }}</td>
        <td>{{ course.unicode }}</td>
        <td>{{ course.start_date }}</td>
        <td>{{ course.end_date }}</td>
        <td>{{ course.fees }}</td>
        <td>
          <a href="{% url 'course_detail' course.id %}" class="view-btn">View More</a> 
          <a href="{% url 'edit_course' course.id %}" class="edit-btn">Edit</a>
          <button onclick="deleteCourse({{ course.id }}, '{{ course.name }}')" class="delete-btn">Delete</button>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="8">No courses available.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
function deleteCourse(courseId, courseName) {
  // Create a form to submit the delete request immediately
  const form = document.createElement('form');
  form.method = 'POST';
  form.action = `/courses/${courseId}/delete/`;
  
  // Add CSRF token
  const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
  const csrfInput = document.createElement('input');
  csrfInput.type = 'hidden';
  csrfInput.name = 'csrfmiddlewaretoken';
  csrfInput.value = csrfToken;
  form.appendChild(csrfInput);
  
  // Submit the form immediately
  document.body.appendChild(form);
  form.submit();
}
</script>

{% endblock %}
