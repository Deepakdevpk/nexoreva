{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/course.css' %}">
{% endblock %}

{% block content %}
<div class="main-content">
  <div class="container">
    <h2>Add New Course</h2>

    <div class="form-container">
      <form method="POST">
        {% csrf_token %}
        
        <!-- Course Information Section -->
        <div class="form-section">
          <h3 class="section-title">
            <i class="bi bi-book"></i>
            Course Information
          </h3>
          
          <div class="form-grid">
            <div class="input-group{% if form.name.errors %} has-error{% endif %}">
              {{ form.name }}
              <label for="{{ form.name.id_for_label }}">Course Name</label>
              {% if form.name.errors %}
                <div class="error-message">{{ form.name.errors|striptags }}</div>
              {% endif %}
            </div>

            <div class="input-group{% if form.sub_column.errors %} has-error{% endif %}">
              {{ form.sub_column }}
              <label for="{{ form.sub_column.id_for_label }}">Sub Column</label>
              {% if form.sub_column.errors %}
                <div class="error-message">{{ form.sub_column.errors|striptags }}</div>
              {% endif %}
            </div>

            <div class="input-group{% if form.unicode.errors %} has-error{% endif %}">
              {{ form.unicode }}
              <label for="{{ form.unicode.id_for_label }}">Unicode</label>
              {% if form.unicode.errors %}
                <div class="error-message">{{ form.unicode.errors|striptags }}</div>
              {% endif %}
            </div>

            <div class="input-group{% if form.description.errors %} has-error{% endif %} full-width">
              {{ form.description }}
              <label for="{{ form.description.id_for_label }}">Description</label>
              {% if form.description.errors %}
                <div class="error-message">{{ form.description.errors|striptags }}</div>
              {% endif %}
            </div>

            <div class="input-group{% if form.start_date.errors %} has-error{% endif %}">
              {{ form.start_date }}
              <label for="{{ form.start_date.id_for_label }}">Start Date</label>
              {% if form.start_date.errors %}
                <div class="error-message">{{ form.start_date.errors|striptags }}</div>
              {% endif %}
            </div>

            <div class="input-group{% if form.end_date.errors %} has-error{% endif %}">
              {{ form.end_date }}
              <label for="{{ form.end_date.id_for_label }}">End Date</label>
              {% if form.end_date.errors %}
                <div class="error-message">{{ form.end_date.errors|striptags }}</div>
              {% endif %}
            </div>

            <div class="input-group{% if form.fees.errors %} has-error{% endif %}">
              {{ form.fees }}
              <label for="{{ form.fees.id_for_label }}">Fees (â‚¹)</label>
              {% if form.fees.errors %}
                <div class="error-message">{{ form.fees.errors|striptags }}</div>
              {% endif %}
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-submit">
            <i class="bi bi-check-circle"></i>
            Create Course
          </button>
          <a href="{% url 'course_list' %}" class="btn-cancel">
            <i class="bi bi-arrow-left"></i>
            Back to Courses
          </a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Define the sub column options for each course
const subColumnOptions = {
  'IT': ['Web Development', 'Data Science', 'Networking', 'Cyber Security'],
  'Engineering': ['Computer Science Engineering (CSE)', 'Mechanical Engineering', 'Civil Engineering', 'Electrical Engineering'],
  'Medical': ['MBBS (Bachelor of Medicine & Bachelor of Surgery)', 'BDS (Bachelor of Dental Surgery)', 'BAMS (Ayurveda)', 'BHMS (Homeopathy)'],
  'Business': ['Accounting', 'Marketing', 'Finance', 'Human Resources'],
  'Arts': ['Painting', 'Music', 'Dance', 'Literature'],
  'Science': ['Physics', 'Chemistry', 'Biology', 'Mathematics']
};

// Function to generate unicode
function generateUnicode() {
  const courseSelect = document.getElementById('id_name');
  const unicodeField = document.getElementById('id_unicode');
  
  if (!courseSelect || !unicodeField) {
    return;
  }
  
  const selectedCourse = courseSelect.value;
  let prefix = 'GEN';
  
  if (selectedCourse) {
    prefix = selectedCourse.substring(0, 3).toUpperCase();
  }
  
  // Generate 5 random digits
  const digits = Math.floor(10000 + Math.random() * 90000);
  const unicode = `${prefix}${digits}`;
  
  unicodeField.value = unicode;
}

// Function to update sub column options
function updateSubColumns() {
  const courseSelect = document.getElementById('id_name');
  const subColumnSelect = document.getElementById('id_sub_column');
  
  if (!courseSelect || !subColumnSelect) {
    return;
  }
  
  const selectedCourse = courseSelect.value;
  const options = subColumnOptions[selectedCourse] || [];
  
  // Clear existing options
  subColumnSelect.innerHTML = '<option value="">Select Sub Column</option>';
  
  // Add new options
  options.forEach(sub => {
    const option = document.createElement('option');
    option.value = sub;
    option.textContent = sub;
    subColumnSelect.appendChild(option);
  });
  
  // Generate new unicode when course changes
  generateUnicode();
}

// Function to handle sub column change
function handleSubColumnChange() {
  const subColumnSelect = document.getElementById('id_sub_column');
  if (subColumnSelect && subColumnSelect.value) {
    generateUnicode();
  }
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  const courseSelect = document.getElementById('id_name');
  const subColumnSelect = document.getElementById('id_sub_column');
  
  if (courseSelect && subColumnSelect) {
    courseSelect.addEventListener('change', updateSubColumns);
    
    // Initialize sub columns based on current selection
    updateSubColumns();
    
    // Generate unicode if course is pre-filled
    if (courseSelect.value) {
      generateUnicode();
    }
  } else {
    console.log('Required elements not found');
  }
});
</script>
{% endblock %}