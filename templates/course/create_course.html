{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/course.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <h2 class="mb-4">ðŸ“š Create New Course Structure</h2>
  
  <!-- Information Alert -->
  <div class="alert alert-warning" role="alert">
    <strong>Important:</strong> You must create at least one sub-course for each course category. 
    This ensures that when adding courses later, there will always be sub-courses available to select from.
  </div>

  <form method="POST">
    {% csrf_token %}
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Course Information</h5>
        
        <div class="mb-3">
          <label for="course_name" class="form-label">Course Name: <span class="text-danger">*</span></label>
          <input type="text" class="form-control" id="course_name" name="course_name" required placeholder="Enter course name (e.g., Engineering, Medical, IT)">
        </div>

        <div class="mb-3">
          <label class="form-label">Sub Courses: <span class="text-danger">*</span></label>
          <div id="sub_courses_container">
            <!-- Sub-course input fields will be added here -->
          </div>
          
          <div class="mb-2">
            <div class="button-group">
              <button type="button" id="add_more_btn" class="btn btn-success" style="background-color: #28a745; color: white; padding: 0.6rem 1.2rem; border: none; border-radius: 6px; font-weight: bold; cursor: pointer;">
                âž• Add Sub Course
              </button>
            </div>
          </div>
          
          <small class="form-text text-muted">
            Add at least one sub-course. Examples: "Computer Science Engineering (CSE)", "MBBS (Bachelor of Medicine & Bachelor of Surgery)", "Web Development"
          </small>
        </div>

        <button type="submit" class="btn btn-primary">Create Course Structure</button>
      </div>
    </div>
  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const addMoreBtn = document.getElementById('add_more_btn');
  const subCoursesContainer = document.getElementById('sub_courses_container');
  const courseNameInput = document.getElementById('course_name');

  function createSubCourseInput() {
    const inputBox = document.createElement('div');
    inputBox.className = 'sub-course-input';
    inputBox.innerHTML = `
      <div class="input-group">
        <input type="text" class="form-control" name="sub_courses[]" placeholder="Enter sub-course name" required>
        <button type="button" class="btn btn-danger remove-btn">Remove</button>
      </div>
    `;

    // Add remove functionality
    const removeBtn = inputBox.querySelector('.remove-btn');
    removeBtn.addEventListener('click', function() {
      inputBox.remove();
    });

    return inputBox;
  }

  // Add first sub-course input by default
  const firstInput = createSubCourseInput();
  subCoursesContainer.appendChild(firstInput);

  // Add more sub-course inputs
  addMoreBtn.addEventListener('click', function() {
    const inputBox = createSubCourseInput();
    subCoursesContainer.appendChild(inputBox);
    // Focus on the new input
    inputBox.querySelector('input').focus();
  });

  // Form validation
  const form = document.querySelector('form');
  form.addEventListener('submit', function(e) {
    const courseName = courseNameInput.value.trim();
    const subCourseInputs = document.querySelectorAll('input[name="sub_courses[]"]');
    let hasValidSubCourse = false;

    if (!courseName) {
      e.preventDefault();
      alert('Please enter a course name.');
      return;
    }

    subCourseInputs.forEach(input => {
      if (input.value.trim()) {
        hasValidSubCourse = true;
      }
    });

    if (!hasValidSubCourse) {
      e.preventDefault();
      alert('Please add at least one sub-course.');
      return;
    }
  });
  
  // Notification function
  function showNotification(message, type) {
    // Remove any existing notifications
    const existingNotifications = document.querySelectorAll('.notification');
    existingNotifications.forEach(n => n.remove());
    
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
      <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
      <span>${message}</span>
      <button class="notification-close" onclick="this.parentElement.remove()">
        <i class="bi bi-x"></i>
      </button>
    `;
    
    document.querySelector('.form-section').insertBefore(notification, document.querySelector('.form-grid'));
    
    // Auto remove after 5 seconds
    setTimeout(() => {
      if (notification.parentElement) {
        notification.remove();
      }
    }, 5000);
  }
});
</script>
{% endblock %}
